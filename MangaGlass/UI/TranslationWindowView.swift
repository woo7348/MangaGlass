//
//  TranslationWindowView.swift
//  MangaGlass
//
//  Created by Í∞ïÎØºÏö∞ on 7/19/25.
//
//import SwiftUI
//
//struct TranslationWindowView: View {
//    @ObservedObject var appState: AppState
//
//    var body: some View {
//        ZStack {
//            // Î∞∞Í≤Ω Î∏îÎü¨ + Ïú†Î¶¨ Ìö®Í≥º
//            RoundedRectangle(cornerRadius: 25)
//                .fill(.ultraThinMaterial)
//                .background(.ultraThinMaterial)
//                .cornerRadius(25)
//                .overlay(
//                    RoundedRectangle(cornerRadius: 25)
//                        .stroke(Color.white.opacity(0.2), lineWidth: 1)
//                )
//                .shadow(color: .black.opacity(0.2), radius: 10, x: 0, y: 10)
//
//            VStack(spacing: 20) {
//                // Ïï± Ïù¥Î¶Ñ
//                Text("MangaGlass")
//                    .font(.system(size: 28, weight: .bold, design: .rounded))
//                    .foregroundColor(.white)
//
//                // Ïñ∏Ïñ¥ ÏÑ†ÌÉù
//                HStack(spacing: 12) {
//                    Picker("From", selection: $appState.sourceLanguage) {
//                        LanguageOptions()
//                    }
//                    .pickerStyle(MenuPickerStyle())
//                    .frame(width: 120)
//                    .background(Color.white.opacity(0.1))
//                    .cornerRadius(10)
//
//                    Image(systemName: "arrow.right")
//                        .foregroundColor(.white.opacity(0.8))
//
//                    Picker("To", selection: $appState.targetLanguage) {
//                        LanguageOptions()
//                    }
//                    .pickerStyle(MenuPickerStyle())
//                    .frame(width: 120)
//                    .background(Color.white.opacity(0.1))
//                    .cornerRadius(10)
//                }
//
//                // ÏÑ∏Î°úÏì∞Í∏∞ ÌÜ†Í∏Ä
//                Toggle("Vertical Writing", isOn: $appState.isVerticalWriting)
//                    .toggleStyle(SwitchToggleStyle(tint: .purple))
//                    .foregroundColor(.white)
//
//                // ÎßêÌíçÏÑ† Î≥ëÌï© Î™®Îìú ÌÜ†Í∏Ä
//                Toggle("Bubble Grouping Mode", isOn: Binding(
//                    get: { appState.mergeMode == .bubbleGrouping },
//                    set: { appState.mergeMode = $0 ? .bubbleGrouping : .unified }
//                ))
//                .toggleStyle(SwitchToggleStyle(tint: .blue))
//                .foregroundColor(.white)
//
//                // Î≥ëÌï© Í∞ÑÍ≤© ÏÑ§Ï†ï Ïä¨ÎùºÏù¥Îçî
//                if appState.mergeMode == .bubbleGrouping {
//                    VStack(spacing: 10) {
//                        Text("Bubble Merge Threshold")
//                            .font(.headline)
//                            .foregroundColor(.white.opacity(0.8))
//
//                        HStack {
//                            Text("X: ")
//                                .foregroundColor(.white)
//                            Slider(value: $appState.mergeXThreshold, in: 0...200, step: 1)
//                                .accentColor(.cyan)
//                            Text("\(Int(appState.mergeXThreshold))")
//                                .foregroundColor(.white)
//                                .frame(width: 40)
//                        }
//
//                        HStack {
//                            Text("Y: ")
//                                .foregroundColor(.white)
//                            Slider(value: $appState.mergeYThreshold, in: 0...200, step: 1)
//                                .accentColor(.cyan)
//                            Text("\(Int(appState.mergeYThreshold))")
//                                .foregroundColor(.white)
//                                .frame(width: 40)
//                        }
//                    }
//                    .padding(.horizontal)
//                }
//
//                // Î≤àÏó≠ Ïã§Ìñâ Î≤ÑÌäº
//                Button(action: {
//                    if let image = appState.capturedImage {
//                        appState.runOCR(on: image)
//                    }
//                }) {
//                    Text("Translate")
//                        .font(.headline)
//                        .frame(maxWidth: .infinity)
//                        .padding()
//                        .background(LinearGradient(
//                            colors: [.purple, .blue],
//                            startPoint: .leading,
//                            endPoint: .trailing))
//                        .cornerRadius(12)
//                        .foregroundColor(.white)
//                        .shadow(radius: 5)
//                }
//
//                // üîΩ Î≤àÏó≠ Í≤∞Í≥º Ï∂úÎ†•
//                if !appState.translatedTexts.isEmpty {
//                    ScrollView {
//                        VStack(alignment: .leading, spacing: 12) {
//                            ForEach(appState.translatedTexts) { text in
//                                VStack(alignment: .leading, spacing: 4) {
//                                    Text("üà∂ \(text.original)")
//                                        .font(.caption)
//                                        .foregroundColor(.gray)
//                                    Text("üåê \(text.translated)")
//                                        .font(.body)
//                                        .foregroundColor(.white)
//                                }
//                                .padding()
//                                .background(Color.white.opacity(0.1))
//                                .cornerRadius(10)
//                            }
//                        }
//                        .padding(.top, 10)
//                    }
//                    .frame(maxHeight: 280)
//                }
//            }
//            .padding()
//        }
//        .frame(width: 420)
//        .padding()
//    }
//}
//
//@ViewBuilder
//private func LanguageOptions() -> some View {
//    Group {
//        Text("Korean").tag("ko")
//        Text("English").tag("en")
//        Text("Japanese").tag("ja")
//        Text("Chinese").tag("zh-CN")
//        Text("Spanish").tag("es")
//        Text("French").tag("fr")
//        Text("Arabic").tag("ar")
//        Text("German").tag("de")
//        Text("Hindi").tag("hi")
//        Text("Russian").tag("ru")
//        Text("Italian").tag("it")
//        Text("Vietnamese").tag("vi")
//        Text("Turkish").tag("tr")
//    }
//}

import SwiftUI

struct TranslationWindowView: View {
    @ObservedObject var appState: AppState

    var body: some View {
        VStack(alignment: .leading, spacing: 12) {

            // üî§ Ïñ∏Ïñ¥ ÏÑ†ÌÉù
            Group {
                Text("ÏõêÎ≥∏ Ïñ∏Ïñ¥ (From)")
                    .font(.caption)
                    .foregroundColor(.secondary)
                Picker("Source Language", selection: $appState.sourceLanguage) {
                    Text("Auto (Detect)").tag("auto")
                    Text("Korean").tag("ko")
                    Text("Japanese").tag("ja")
                    Text("English").tag("en")
                    Text("Chinese (Simplified)").tag("zh-CN")
                    Text("Chinese (Traditional)").tag("zh-TW")
                    Text("Spanish").tag("es")
                    Text("French").tag("fr")
                    Text("Arabic").tag("ar")
                    Text("German").tag("de")
                    Text("Hindi").tag("hi")
                    Text("Russian").tag("ru")
                    Text("Italian").tag("it")
                    Text("Vietnamese").tag("vi")
                    Text("Thai").tag("th")
                    Text("Lao").tag("lo")
                    Text("Myanmar").tag("my")
                    Text("Indonesian").tag("id")
                    Text("Malay").tag("ms")
                    Text("Khmer (Cambodian)").tag("km")
                    Text("Tagalog (Filipino)").tag("tl")
                    Text("Turkish").tag("tr")
                    Text("Hebrew").tag("iw") // Ïù¥Ïä§ÎùºÏóòÏñ¥
                }
                .pickerStyle(PopUpButtonPickerStyle())

                Text("Î≤àÏó≠ Ïñ∏Ïñ¥ (To)")
                    .font(.caption)
                    .foregroundColor(.secondary)
                Picker("Target Language", selection: $appState.targetLanguage) {
                    Text("Korean").tag("ko")
                    Text("Japanese").tag("ja")
                    Text("English").tag("en")
                    Text("Chinese (Simplified)").tag("zh-CN")
                    Text("Chinese (Traditional)").tag("zh-TW")
                    Text("Spanish").tag("es")
                    Text("French").tag("fr")
                    Text("Arabic").tag("ar")
                    Text("German").tag("de")
                    Text("Hindi").tag("hi")
                    Text("Russian").tag("ru")
                    Text("Italian").tag("it")
                    Text("Vietnamese").tag("vi")
                    Text("Thai").tag("th")
                    Text("Lao").tag("lo")
                    Text("Myanmar").tag("my")
                    Text("Indonesian").tag("id")
                    Text("Malay").tag("ms")
                    Text("Khmer (Cambodian)").tag("km")
                    Text("Tagalog (Filipino)").tag("tl")
                    Text("Turkish").tag("tr")
                    Text("Hebrew").tag("iw")
                }
                .pickerStyle(PopUpButtonPickerStyle())
            }

            Divider()

            // üß† Î≥ëÌï© Î™®Îìú ÏÑ†ÌÉù
            VStack(alignment: .leading) {
                Text("ÏùΩÍ∏∞ Î∞©Ïãù")
                    .font(.caption)
                    .foregroundColor(.secondary)

                Picker("Merge Mode", selection: $appState.mergeMode) {
                    Text("Í∞ÄÎ°ú ÏùΩÍ∏∞").tag(MergeMode.unified)
                    Text("ÏÑ∏Î°ú ÏùΩÍ∏∞(ÏùºÎ≥∏ ÎßåÌôî)").tag(MergeMode.verticalBlockMerge)
                }
                .pickerStyle(SegmentedPickerStyle())
            }

            // üìê Ï†ïÎ†¨ Í∏∞Ï§Ä ÏÑ§Ï†ï
            VStack(alignment: .leading) {
                Text("ÏùΩÍ∏∞ ÏàúÏÑú")
                    .font(.caption)
                    .foregroundColor(.secondary)

                Picker("Sort Axis", selection: $appState.sortAxis) {
                    Text("ÏúÑ ‚Üí ÏïÑÎûò ‚Üí Ïôº ‚Üí Ïò§").tag(SortAxis.yFirst)
                    Text("Ïôº ‚Üí Ïò§ ‚Üí ÏúÑ ‚Üí ÏïÑÎûò").tag(SortAxis.xFirst)
                }
                .pickerStyle(SegmentedPickerStyle())
            }

            // üìè Î≥ëÌï© Í∞ÑÍ≤© ÏÑ§Ï†ï
            VStack(alignment: .leading) {
                Text("Î≥ëÌï© Í∞ÑÍ≤©")
                    .font(.caption)
                    .foregroundColor(.secondary)

                HStack {
                    Text("X: \(Int(appState.mergeXThreshold))")
                    Slider(value: $appState.mergeXThreshold, in: 500...1700)
                }

                HStack {
                    Text("Y: \(Int(appState.mergeYThreshold))")
                    Slider(value: $appState.mergeYThreshold, in: 200...1700)
                }
            }

            Divider()

            // üîÅ Î≤àÏó≠ Ïã§Ìñâ Î≤ÑÌäº
            Button(action: {
                appState.captureOverlayArea { image in
                    if let image = image {
                        appState.runOCR(on: image)
                    } else {
                        print("‚ö†Ô∏è Ïù¥ÎØ∏ÏßÄ Ï∫°Ï≤ò Ïã§Ìå®")
                    }
                }
            }) {
                Text("Translate")
                    .frame(maxWidth: .infinity)
                    .padding(8)
                    .background(Color.accentColor)
                    .foregroundColor(.white)
                    .cornerRadius(6)
            }
            
            Button {
                appState.captureByDragAndTranslate()
            } label: {
                Text("ÏòÅÏó≠ ÏÑ†ÌÉù ÌõÑ Î≤àÏó≠")
                    .frame(maxWidth: .infinity)
                    .padding(8)
                    .background(Color.blue)
                    .foregroundColor(.white)
                    .cornerRadius(6)
            }

            Divider()

            // üåç Î≤àÏó≠ Í≤∞Í≥º
            ScrollView {
                VStack(alignment: .leading, spacing: 8) {
                    ForEach(appState.translatedTexts) { text in
                        VStack(alignment: .leading, spacing: 4) {
                            Text("üà∂ [\(text.index)] ÏõêÎ¨∏: \(text.original)")
                                .font(.caption)
                                .foregroundColor(.gray)
                                .textSelection(.enabled)
                            Text("üåê Î≤àÏó≠: \(text.translated)")
                                .font(.body)
                                .foregroundColor(.primary)
                                .textSelection(.enabled)
                        }
                        .padding(6)
                        .background(Color.gray.opacity(0.1))
                        .cornerRadius(6)
                    }
                }
            }

            Spacer()
        }
        .padding()
        .frame(minWidth: 360, idealWidth: 380, maxWidth: .infinity,
               minHeight: 420, idealHeight: 460, maxHeight: .infinity)
    }
}

